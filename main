task.spawn(function()
    if not game:IsLoaded() then game.Loaded:Wait() end

    local HttpService = game:GetService("HttpService")
    local TeleportService = game:GetService("TeleportService")
    local Players = game:GetService("Players")
    local Player = Players.LocalPlayer
    local PlaceId = game.PlaceId
    local JobId = game.JobId

    local RootFolder = "ServerHop"
    local StorageFile = `{RootFolder}/{PlaceId}.json`
    local Tracked = { Start = tick(), Jobs = {} }

    if not isfolder(RootFolder) then makefolder(RootFolder) end
    if isfile(StorageFile) then
        local data = HttpService:JSONDecode(readfile(StorageFile))
        if tick() - data.Start < 3600 then
            Tracked = data
        end
    end
    if not table.find(Tracked.Jobs, JobId) then
        table.insert(Tracked.Jobs, JobId)
        writefile(StorageFile, HttpService:JSONEncode(Tracked))
    end

    local function InstantServerHop()
        local cursor = ""
        local success, res = pcall(function()
            return game:HttpGet(`https://games.roblox.com/v1/games/{PlaceId}/servers/Public?sortOrder=Asc&limit=100`)
        end)

        if success then
            local body = HttpService:JSONDecode(res)
            local servers = body.data
            for _, server in pairs(servers) do
                if server.playing < server.maxPlayers and server.id ~= JobId and not table.find(Tracked.Jobs, server.id) then
                    table.insert(Tracked.Jobs, server.id)
                    writefile(StorageFile, HttpService:JSONEncode(Tracked))
                    TeleportService:TeleportToPlaceInstance(PlaceId, server.id, Player)
                    return
                end
            end
        end

        warn("âš  No new server found instantly.")
    end

    -- GUI Setup
    local guiParent = Player:WaitForChild("PlayerGui", 5) or game:GetService("CoreGui")
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ServerHopUI"
    screenGui.ResetOnSpawn = false
    screenGui.IgnoreGuiInset = true
    screenGui.Parent = guiParent

    local function CreateButtonFrame(position, text, onClick)
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0, 150, 0, 45)
        frame.Position = position
        frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        frame.BorderSizePixel = 0
        frame.Active = true
        frame.Draggable = true
        frame.Parent = screenGui

        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, 0, 1, 0)
        button.Text = text
        button.TextColor3 = Color3.new(1, 1, 1)
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        button.Font = Enum.Font.GothamBold
        button.TextSize = 17
        button.AutoButtonColor = true
        button.Parent = frame

        button.MouseButton1Click:Connect(onClick)
    end

    -- Buttons
    CreateButtonFrame(
        UDim2.new(0.5, -160, 1, -130),
        "Rejoin Server",
        function()
            TeleportService:TeleportToPlaceInstance(PlaceId, JobId, Player)
        end
    )

    CreateButtonFrame(
        UDim2.new(0.5, 10, 1, -130),
        "Server Hop",
        function()
            InstantServerHop()
        end
    )
end)
